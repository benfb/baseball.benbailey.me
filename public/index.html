<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.19" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  
  <title>Ben Does Baseball</title>
  

  
  <link rel="stylesheet" href="https://baseball.benbailey.me/css/poole.css">
  <link rel="stylesheet" href="https://baseball.benbailey.me/css/syntax.css">
  <link rel="stylesheet" href="https://baseball.benbailey.me/css/hyde.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400italic,700|Fugaz+One">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.png">

  
  <link href="https://baseball.benbailey.me/index.xml" rel="alternate" type="application/rss+xml" title="Ben Does Baseball" />
</head>

<body class="theme-base-09 ">

<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="https://baseball.benbailey.me/"><h1>Ben Does Baseball</h1></a>
      <p class="lead">
       A home for Ben Bailey&#39;s baseball analytics projects. 
      </p>
    </div>

    <ul class="sidebar-nav">
      <li><a href="/">Home</a> </li>
      <li><a href="https://github.com/benfb/baseball">Code</a> </li>
      
        <li><a href="/schedule"> Schedule </a></li>
      
    </ul>

    <p>&copy; 2017. All rights reserved. </p>
  </div>
</div>


    <div class="content container">
<div class="posts">

      
        
  <div class="post">
    <h1 class="post-title">
      <a href="https://baseball.benbailey.me/2017/03/carl-edwards-jr-bad-day-great-year/">
        Carl Edwards Had a Bad Day in a Great Year
      </a>
    </h1>

    <span class="post-date">Thu, Mar 16, 2017</span>

    <p>This week I played around with the <a href="http://billpetti.github.io/baseballr"><code>baseballr</code></a> package, which provides easy access to FanGraphs, Baseball Reference, and Statcast data in R<sup class="footnote-ref" id="fnref:1"><a rel="footnote" href="#fn:1">1</a></sup>.</p>

<p>I&rsquo;ve been particularly intrigued recently by <a href="http://www.baseball-reference.com/players/e/edwarca01.shtml">Carl Edwards Jr.</a>, a Cubs reliever who got called up last season. He had always seemed to be surprisingly good, but I wasn&rsquo;t aware quite how good he was until I calculated <a href="http://www.fangraphs.com/library/offense/woba/">wOBA</a> allowed by pitchers in 2016 and found that he had the third lowest in the league, behind only Kenley Jansen and Zach Britton, and in front of Clayton Kershaw, Aroldis Chapman, and Andrew Miller. Ranking Edwards among four of the game&rsquo;s top closers and the game&rsquo;s best starter seemed strange. Here are the six pitchers with the lowest wOBA-against last season:</p>

<table>
<thead>
<tr>
<th>Name</th>
<th>IP</th>
<th>ERA</th>
<th>WHIP</th>
<th>BABIP</th>
<th>FIP</th>
<th>wOBA</th>
</tr>
</thead>

<tbody>
<tr>
<td>Zach Britton</td>
<td>67.0</td>
<td>0.54</td>
<td>0.836</td>
<td>0.231</td>
<td>1.80</td>
<td>0.188</td>
</tr>

<tr>
<td>Kenley Jansen</td>
<td>68.2</td>
<td>1.83</td>
<td>0.670</td>
<td>0.244</td>
<td>1.34</td>
<td>0.188</td>
</tr>

<tr>
<td>Carl Edwards</td>
<td>36.0</td>
<td>3.75</td>
<td>0.806</td>
<td>0.162</td>
<td>2.79</td>
<td>0.201</td>
</tr>

<tr>
<td>Clayton Kershaw</td>
<td>149.2</td>
<td>1.68</td>
<td>0.722</td>
<td>0.256</td>
<td>1.78</td>
<td>0.202</td>
</tr>

<tr>
<td>Aroldis Chapman</td>
<td>58.0</td>
<td>1.55</td>
<td>0.862</td>
<td>0.268</td>
<td>1.42</td>
<td>0.206</td>
</tr>

<tr>
<td>Andrew Miller</td>
<td>74.1</td>
<td>1.45</td>
<td>0.686</td>
<td>0.258</td>
<td>1.68</td>
<td>0.209</td>
</tr>
</tbody>
</table>

<p>Edwards stands out negatively in several respects here. He pitched the least innings out of that group by far, and was almost certainly put in the least stressful situations. His ERA is almost two points higher than the next highest&rsquo;s, and his FIP is nearly a point higher than Britton&rsquo;s, the second highest mark. His BABIP is also remarkably low, due in part to luck and in part to the Cubs&rsquo; historically good defense. So why is his wOBA so remarkable?</p>

<p>Looking through Edwards&rsquo; <a href="http://www.baseball-reference.com/players/gl.fcgi?id=edwarca01&amp;t=p&amp;year=2016">game log</a>, two bad appearances stand out:</p>

<ol>
<li>August 13th, where he allowed five runs on one hit and four walks while recording just two outs.</li>
<li>September 17th, where he allowed three runs on three hits (two of them home runs) in an inning&rsquo;s work.</li>
</ol>

<p>If we remove the August 13th outing, Edwards&rsquo; ERA drops to <code>2.55</code>, almost an entire point. If we remove the September 17th outing as well, it drops to <code>1.83</code>. Removing the first performance, his FIP drops to <code>2.56</code>. Removing the other brings it down to <code>1.96</code>, which is still higher than the other five pitchers (possibly due to his BABIP) but much closer. Bad pitching performances are part of a pitcher&rsquo;s year, and shouldn&rsquo;t be entirely disregarded. However, it seems likely that <em>something</em> was off (mechanically, physically, or mentally) on August 13th.</p>

<p>We&rsquo;ll get back to these games later.</p>

<p>As the Cubs consistently carried three catchers last season, I thought it would be interesting to compare Edwards&rsquo; performance across all three:</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span></span>cej_by_catcher &lt;- cej %&gt;%
  group_by(pitch_type, catcher) %&gt;%
  summarize(n = n(),
            avg_mph = <span style="color: #0000aa">mean</span>(<span style="color: #0000aa">as.numeric</span>(<span style="color: #0000aa">as.character</span>(start_speed)), na.rm = <span style="color: #0000aa">TRUE</span>),
            avg_spin = <span style="color: #0000aa">mean</span>(<span style="color: #0000aa">as.numeric</span>(<span style="color: #0000aa">as.character</span>(spin_rate)), na.rm = <span style="color: #0000aa">TRUE</span>),
            avg_hit_distance = <span style="color: #0000aa">mean</span>(hit_distance_sc, na.rm = <span style="color: #0000aa">TRUE</span>),
            avg_hit_speed = <span style="color: #0000aa">mean</span>(hit_speed, na.rm = <span style="color: #0000aa">TRUE</span>),
            avg_hit_angle = <span style="color: #0000aa">mean</span>(hit_angle, na.rm = <span style="color: #0000aa">TRUE</span>),
            avg_barrel = <span style="color: #0000aa">mean</span>(barrel, na.rm = <span style="color: #0000aa">TRUE</span>),
            avg_ext = <span style="color: #0000aa">mean</span>(release_extension, na.rm = <span style="color: #0000aa">TRUE</span>)) %&gt;%
  mutate(pitch_pct = n/<span style="color: #0000aa">sum</span>(n)) %&gt;%
  filter(pitch_type != <span style="color: #aa5500">&quot;CH&quot;</span>, pitch_type != <span style="color: #aa5500">&quot;IN&quot;</span>) <span style="color: #aaaaaa; font-style: italic"># These each occur once and may be mistakes</span>
</pre></div>

<p>The <code>baseballr</code> package also allows us to look at Statcast data from Baseball Savant:</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span></span>cej &lt;- scrape_statcast_savant_pitcher(start_date = <span style="color: #aa5500">&quot;2016-04-06&quot;</span>, end_date = <span style="color: #aa5500">&quot;2016-10-15&quot;</span>, pitcherid = <span style="color: #009999">605218</span>)
</pre></div>

<table>
<thead>
<tr>
<th align="center">type</th>
<th align="center">catcher</th>
<th align="center">count</th>
<th align="center">mph</th>
<th align="center">hit_dist</th>
<th align="center">hit_spd</th>
<th align="center">pct</th>
</tr>
</thead>

<tbody>
<tr>
<td align="center">CU</td>
<td align="center">Ross</td>
<td align="center">27</td>
<td align="center">81.16</td>
<td align="center">119</td>
<td align="center">73.6</td>
<td align="center">16.67%</td>
</tr>

<tr>
<td align="center">CU</td>
<td align="center">Montero</td>
<td align="center">53</td>
<td align="center">81.54</td>
<td align="center">258.8</td>
<td align="center">94.86</td>
<td align="center">32.72%</td>
</tr>

<tr>
<td align="center">CU</td>
<td align="center">Federowicz</td>
<td align="center">3</td>
<td align="center">81.25</td>
<td align="center">NA</td>
<td align="center">NA</td>
<td align="center">1.85%</td>
</tr>

<tr>
<td align="center">CU</td>
<td align="center">Contreras</td>
<td align="center">79</td>
<td align="center">81.02</td>
<td align="center">208.8</td>
<td align="center">87.74</td>
<td align="center">48.77%</td>
</tr>

<tr>
<td align="center">FF</td>
<td align="center">Ross</td>
<td align="center">99</td>
<td align="center">95.72</td>
<td align="center">186.8</td>
<td align="center">84.31</td>
<td align="center">21.57%</td>
</tr>

<tr>
<td align="center">FF</td>
<td align="center">Montero</td>
<td align="center">147</td>
<td align="center">95.44</td>
<td align="center">211.1</td>
<td align="center">83.77</td>
<td align="center">32.03%</td>
</tr>

<tr>
<td align="center">FF</td>
<td align="center">Federowicz</td>
<td align="center">9</td>
<td align="center">95.77</td>
<td align="center">183</td>
<td align="center">95.5</td>
<td align="center">1.96%</td>
</tr>

<tr>
<td align="center">FF</td>
<td align="center">Contreras</td>
<td align="center">204</td>
<td align="center">95.44</td>
<td align="center">199.4</td>
<td align="center">85.94</td>
<td align="center">44.44%</td>
</tr>
</tbody>
</table>

<p>From the table, we can see that Edwards throws two main pitches—a four-seam fastball and a curveball. He pitched most often to Willson Contreras, then Miguel Montero, then David Ross (and once to Tim Federowicz). Edwards threw his fastball a notch faster to Ross than other catchers, which could be due to the small sample size. He also threw his fastball more to Ross than other catchers: despite throwing 16.67% of his curveballs to Ross, he threw 21.57% of his fastballs to him. There are several reasons this might be the case:</p>

<ol>
<li>Edwards focused on his fastball earlier in the season before gaining more confidence in his curve.</li>
<li>Ross saw that Edwards&rsquo; fastball was producing better results and called it more often.</li>
<li>Contreras was more confident in his agility and therefore ability to block a curveball than Ross was.</li>
<li>Random sampling and a small sample size.</li>
</ol>

<p>Let&rsquo;s take a look at the results these pitches got. By plotting hit velocity and hit distance, we can compare results across catchers:</p>

<p><img src="/images/cevd1.png" alt="blah" /></p>

<p>When Ross was catching, Edwards tended to generate softer contact that went shorter distances. We can use the Statcast data to see why that is.</p>

<p><img src="/images/cesv1.png" alt="blah" /></p>

<p>This chart, plotting spin against pitch velocity, shows something interesting: Edwards&rsquo; pitches had the highest spin when throwing to Ross. Curveballs with higher spin tend to induce more ground balls<sup class="footnote-ref" id="fnref:2"><a rel="footnote" href="#fn:2">2</a></sup>, which is advantageous for Edwards thanks in part to the defense behind him. High spin on his four-seamer is essential to Edwards&rsquo; style, and that was maximized when Ross was catching. Of course, this isn&rsquo;t necessarily related to the catcher. It could be the case that Ross just happened to catch Edwards on his better days. For greater parity, we can look to see what happens to Contreras&rsquo; numbers if we take away the two worst games in Edwards&rsquo; season.</p>

<p><img src="/images/cevd2.png" alt="blah" /></p>

<p>Already we see that removing the two bad outings brings Contreras much closer to Ross and  Montero in terms of average hit speed and hit distance. Now we can look at how removing the bad outing affects velocity and spin.</p>

<p><img src="/images/cesv2.png" alt="blah" /></p>

<p>There isn&rsquo;t any effect on the spin of Edwards&rsquo; curveball while Contreras is catching, but the spin on his fastball gets much closer to Ross than Montero. Let&rsquo;s compare Edwards&rsquo; Statcast data between the August 13th outing and his overall averages (the bolded rows are from the 13th):</p>

<table>
<thead>
<tr>
<th>Type</th>
<th>MPH</th>
<th>Spin</th>
<th>Ext</th>
</tr>
</thead>

<tbody>
<tr>
<td>FF</td>
<td>95.55</td>
<td>1876</td>
<td>6.85</td>
</tr>

<tr>
<td><strong>FF</strong></td>
<td><strong>94.60</strong></td>
<td><strong>1602</strong></td>
<td><strong>6.73</strong></td>
</tr>

<tr>
<td>CU</td>
<td>81.20</td>
<td>1605</td>
<td>6.31</td>
</tr>

<tr>
<td><strong>CU</strong></td>
<td><strong>81.49</strong></td>
<td><strong>1480</strong></td>
<td><strong>6.19</strong></td>
</tr>
</tbody>
</table>

<p>If we add in the other poor outing:</p>

<table>
<thead>
<tr>
<th>Type</th>
<th>MPH</th>
<th>Spin</th>
<th>Ext</th>
</tr>
</thead>

<tbody>
<tr>
<td>FF</td>
<td>95.54</td>
<td>1873</td>
<td>6.85</td>
</tr>

<tr>
<td><strong>FF</strong></td>
<td><strong>95.08</strong></td>
<td><strong>1749</strong></td>
<td><strong>6.74</strong></td>
</tr>

<tr>
<td>CU</td>
<td>81.23</td>
<td>1610</td>
<td>6.31</td>
</tr>

<tr>
<td><strong>CU</strong></td>
<td><strong>81.12</strong></td>
<td><strong>1502</strong></td>
<td><strong>6.26</strong></td>
</tr>
</tbody>
</table>

<p>Adding in the second bad outing makes the numbers more similar, lending credence to the idea that the first outing was an outlier. On August 13th the spin on his fastball, his extension, and his velocity were all down a tick.</p>

<p>Carl Edwards had a quietly great year out of the bullpen for the Cubs. He was among the league leaders in wOBA-against, which is initially surprising based on his peripheral numbers. Upon removing an outing where the spin rate and velocity on his signature pitch took a steep downturn, Edwards&rsquo; peripheral numbers match up more closely with the type of performance you&rsquo;d expect from someone in that elite group of pitchers. Carl Edwards had a bad day—here&rsquo;s to more good ones.</p>
<div class="footnotes">

<hr />

<ol>
<li id="fn:1">As part of this analysis, I defined a function <code>playername_lookup</code> that gets a player&rsquo;s name from their MLBAM id (this function is based on the <code>playerid_lookup</code> function from the <code>baseballr</code> package). It is provided <a href="https://gist.github.com/benfb/c2be996bcdbf0b1fa9f7f544fceb2934">here</a> for reference.
 <a class="footnote-return" href="#fnref:1"><sup>[return]</sup></a></li>
<li id="fn:2"><a href="http://m.mlb.com/news/article/160896926/statcast-spin-rate-compared-to-velocity/">http://m.mlb.com/news/article/160896926/statcast-spin-rate-compared-to-velocity/</a>
 <a class="footnote-return" href="#fnref:2"><sup>[return]</sup></a></li>
</ol>
</div>

  </div>
    
  
        
  <div class="post">
    <h1 class="post-title">
      <a href="https://baseball.benbailey.me/2017/03/events-and-dynamic-ui/">
        Events and Dynamic UI
      </a>
    </h1>

    <span class="post-date">Fri, Mar 3, 2017</span>

    <p>This week I focused on improving the usability of the Shiny app. I used Shiny&rsquo;s
<code>renderUI</code> function to dynamically generate the options for the game select
dropdown. I also set up a baseball API <a href="http://bbbaseball.herokuapp.com">here</a>, and added another API
endpoint to get the list of games that happened on any given day.</p>

<p>One of the nicer things I added to the Shiny app was the use of the <code>tryCatch</code>
function to hide confusing error messages from the user, like this:</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span></span><span style="color: #0000aa">tryCatch</span>({
     splitGames &lt;- <span style="color: #0000aa">unlist</span>(<span style="color: #0000aa">strsplit</span>(input$game, <span style="color: #aa5500">&quot; @ &quot;</span>))
     away &lt;- teams[<span style="color: #0000aa">which</span>(<span style="color: #0000aa">grepl</span>(splitGames[<span style="color: #009999">1</span>], <span style="color: #0000aa">names</span>(teams)))]
     home &lt;- teams[<span style="color: #0000aa">which</span>(<span style="color: #0000aa">grepl</span>(splitGames[<span style="color: #009999">2</span>], <span style="color: #0000aa">names</span>(teams)))]

     data &lt;- getEvents(year, month, day, away, home)
     sliderInput(<span style="color: #aa5500">&quot;event&quot;</span>, <span style="color: #aa5500">&quot;Event:&quot;</span>,
                 min = <span style="color: #009999">1</span>, max = <span style="color: #0000aa">length</span>(data$probabilities),
                 value = <span style="color: #0000aa">length</span>(data$probabilities), sep = <span style="color: #009999">1</span>)
   }, error = <span style="color: #0000aa">function</span>(e) {
     <span style="color: #0000aa">stop</span>(<span style="color: #aa5500">&quot;That is not a valid event&quot;</span>)
   })
</pre></div>

<p>In reality, much of my week was spent fighting with R&rsquo;s several methods of
dealing with strings and arrays. Most of the changes this week were in the front
end user-facing part of the app, so I&rsquo;m excited to work more on the backend next
week (maybe finally improving the win probability calculation?). As a side note,
the app does generally work for spring training games (as long as Gameday is
working at the moment).</p>

  </div>
    
  
        
  <div class="post">
    <h1 class="post-title">
      <a href="https://baseball.benbailey.me/2017/02/an-app/">
        An App!
      </a>
    </h1>

    <span class="post-date">Wed, Feb 22, 2017</span>

    <p>This week I made a Shiny interface to the win probability and description services.
It can be viewed <a href="https://benfb.shinyapps.io/bbbaseball">here</a>. To do this, I had to set up hosting for
both Shiny and my Elixir backend service. I also switched from embedding/posting
the plots on Plotly to embedding them in the new Shiny application, which should
help reduce costs. Learning more about Shiny made implementing the interface
relatively simple. The generation of the graphs is now abstracted into a
function that grabs JSON data from the API server I set up, which makes it much
easier to generate graphs for any desired game.</p>

<p>I would like to make several improvements to the graph next week. Including
scores would be helpful. Perhaps most interesting would be implementing
automatic &ldquo;swing-point&rdquo; detection and adding concise labels for the greatest
win probability changes in a game. Finally, it would be nice if there were a
way to view which teams played on which days, as right now it&rsquo;s difficult to
find a game that you want to graph.</p>

  </div>
    
  
        
  
        
  <div class="post">
    <h1 class="post-title">
      <a href="https://baseball.benbailey.me/2017/02/descriptions-and-probabilities/">
        Descriptions and Probabilities
      </a>
    </h1>

    <span class="post-date">Wed, Feb 8, 2017</span>

    <p>This week I mostly focused on experimenting with the Retrosheet and MLB Gameday API formats.
Using the <code>baseball</code> umbrella application combined with R and Plotly, I generated a win expectancy
graph for a random game.</p>

<p>In any given situation, the win expectancy is equivalent to the percentage of games
that teams in that exact situation went on to win. To calculate the win probability of
a situation, the application converts the situation into a hash using the number of outs,
inning, number and position of base runners, and the current score, then looks it up in a
table of historical win probabilities. This table was calculated using <a href="https://gregstoll.dyndns.org/~gregstoll/baseball/stats.html">Greg Stoll&rsquo;s scripts</a>
and <a href="http://www.retrosheet.org">Retrosheet</a> data. The code for the win expectancy service can be found
<a href="https://github.com/benfb/baseball/tree/master/apps/baseball_win_ex">here</a>, and the general downloader&rsquo;s source is <a href="https://github.com/benfb/baseball/tree/master/apps/baseball_slurper">here</a>. What follows
is an example of a manually-generated win expectancy graph of the game that occurred
on May 10th of last season between the Padres and the Cubs.</p>

<p>First, we utilize the two functions <code>probabilities_from_game/2</code> and <code>descriptions_from_game/2</code>
to get vectors of win expectancies and descriptions of every event that occurred in the game:</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span></span>iex(<span style="color: #009999">1</span>)&gt; <span style="color: #00aa00; text-decoration: underline">BaseballSlurper.Server</span>.probabilities_from_game(<span style="color: #aa5500">&quot;2016-05-10&quot;</span>, [<span style="color: #aa5500">&quot;sdn&quot;</span>, <span style="color: #aa5500">&quot;chn&quot;</span>])
[[<span style="color: #009999">0.5652355266525733</span>, <span style="color: #009999">0.5826495329514373</span>, <span style="color: #009999">0.593064127007075</span>],
 [<span style="color: #009999">0.5669081828973761</span>, <span style="color: #009999">0.5470361185179661</span>, <span style="color: #009999">0.534091190836288</span>],
 [<span style="color: #009999">0.5569277494191046</span>, <span style="color: #009999">0.5742743999613658</span>, <span style="color: #009999">0.5803200220916497</span>],...]

iex(<span style="color: #009999">2</span>)&gt; <span style="color: #00aa00; text-decoration: underline">BaseballSlurper.Server</span>.descriptions_from_game(<span style="color: #aa5500">&quot;2016-05-10&quot;</span>, [<span style="color: #aa5500">&quot;sdn&quot;</span>, <span style="color: #aa5500">&quot;chn&quot;</span>])
[[<span style="color: #aa5500">&quot;Jon Jay grounds out, second baseman Ben Zobrist to first baseman Anthony Rizzo.&quot;</span>,
  <span style="color: #aa5500">&quot;Wil Myers flies out to center fielder Dexter Fowler.&quot;</span>,
  <span style="color: #aa5500">&quot;Matt Kemp lines out to center fielder Dexter Fowler.&quot;</span>],
 [<span style="color: #aa5500">&quot;Dexter Fowler strikes out swinging.&quot;</span>,
  <span style="color: #aa5500">&quot;Jason Heyward lines out to center fielder Jon Jay.&quot;</span>,
  <span style="color: #aa5500">&quot;Kris Bryant lines out to right fielder Matt Kemp.&quot;</span>],...]
</pre></div>

<p>We can then plug these two vectors into R to get an interactive win expectancy graph with Plotly:</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span></span><span style="color: #0000aa">library</span>(plotly)
<span style="color: #0000aa">Sys.setenv</span>(<span style="color: #aa5500">&quot;plotly_username&quot;</span> = <span style="color: #aa5500">&quot;benfb&quot;</span>)
<span style="color: #0000aa">Sys.setenv</span>(<span style="color: #aa5500">&quot;plotly_api_key&quot;</span> = API_KEY)
probabilities &lt;- <span style="color: #00aaaa">c</span>(PROBABILITY_VECTOR)
x &lt;- <span style="color: #0000aa">seq_along</span>(y)
event &lt;- <span style="color: #00aaaa">c</span>(DESCRIPTION_VECTOR)
data &lt;- <span style="color: #00aaaa">data.frame</span>(x, y, event)

kb &lt;- <span style="color: #00aaaa">list</span>(
  xref = <span style="color: #aa5500">&#39;paper&#39;</span>,
  yref = <span style="color: #aa5500">&#39;y&#39;</span>,
  x = <span style="color: #0000aa">seq</span>(<span style="color: #009999">0</span>, <span style="color: #009999">1</span>, by=(<span style="color: #009999">1</span>/<span style="color: #0000aa">length</span>(x)))[<span style="color: #009999">23</span>],
  y = probabilities[<span style="color: #009999">23</span>],
  xanchor = <span style="color: #aa5500">&#39;right&#39;</span>,
  yanchor = <span style="color: #aa5500">&#39;middle&#39;</span>,
  text = <span style="color: #aa5500">&#39;K Bryant Double&#39;</span>,
  font = <span style="color: #00aaaa">list</span>(family = <span style="color: #aa5500">&#39;Arial&#39;</span>,
              size = <span style="color: #009999">16</span>,
              color = <span style="color: #aa5500">&#39;rgba(67,67,67,1)&#39;</span>),
  showarrow = <span style="color: #0000aa">FALSE</span>)

ad &lt;- <span style="color: #00aaaa">list</span>(
  xref = <span style="color: #aa5500">&#39;paper&#39;</span>,
  yref = <span style="color: #aa5500">&#39;y&#39;</span>,
  x = <span style="color: #0000aa">seq</span>(<span style="color: #009999">0</span>, <span style="color: #009999">1</span>, by=(<span style="color: #009999">1</span>/<span style="color: #0000aa">length</span>(x)))[<span style="color: #009999">72</span>],
  y = probabilities[<span style="color: #009999">72</span>],
  xanchor = <span style="color: #aa5500">&#39;right&#39;</span>,
  yanchor = <span style="color: #aa5500">&#39;middle&#39;</span>,
  text = <span style="color: #aa5500">&#39;A Dickerson Home Run&#39;</span>,
  font = <span style="color: #00aaaa">list</span>(family = <span style="color: #aa5500">&#39;Arial&#39;</span>,
              size = <span style="color: #009999">16</span>,
              color = <span style="color: #aa5500">&#39;rgba(67,67,67,1)&#39;</span>),
  showarrow = <span style="color: #0000aa">FALSE</span>)

p &lt;- plot_ly(
  data,
  x = <span style="color: #0000aa">seq_along</span>(y),
  y = probabilities,
  type = <span style="color: #aa5500">&#39;scatter&#39;</span>,
  mode = <span style="color: #aa5500">&#39;lines&#39;</span>,
  text = event) %&gt;%
layout(
  title = <span style="color: #aa5500">&#39;SDN @ CHN 2016-05-10&#39;</span>,
  xaxis = <span style="color: #00aaaa">list</span>(title = <span style="color: #aa5500">&#39;Game Event&#39;</span>),
  yaxis = <span style="color: #00aaaa">list</span>(title = <span style="color: #aa5500">&#39;Home Team Win Probability&#39;</span>)) %&gt;%
layout(annotations = <span style="color: #00aaaa">list</span>(kb, ad))
</pre></div>

<p>This R code yields the following chart:</p>

<iframe width="100%" height="500" frameborder="0" scrolling="no" src="//plot.ly/~benfb/0.embed"></iframe>

<p>For comparison, the Fangraph&rsquo;s win expectancy graph is <a href="http://www.fangraphs.com/wins.aspx?date=2016-05-10&amp;team=Cubs&amp;dh=0&amp;season=2016">here</a>, and you can find
the full video of the game on <a href="https://www.youtube.com/watch?v=wGqoB_8hNtw">MLB&rsquo;s YouTube channel</a><sup class="footnote-ref" id="fnref:1"><a rel="footnote" href="#fn:1">1</a></sup>.</p>

<p>The next step will be to automate this process and look into self-hosting
the graphs instead of going through Plotly&rsquo;s rate-limited API.</p>
<div class="footnotes">

<hr />

<ol>
<li id="fn:1">The date in the title of this video is actually incorrect. It&rsquo;s actually the game from May 10th.
 <a class="footnote-return" href="#fnref:1"><sup>[return]</sup></a></li>
</ol>
</div>

  </div>
    
  
</div>
</div>

  </body>
</html>
